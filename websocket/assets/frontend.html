<!DOCTYPE>
<html>
<head>

<script src="/js/d3.js"></script>

<script>
var socket = null;
var sent = 0;
var recv = 0;
var length = 65536;

function open(evt) {
	var msg = "";
	var alphabet = "abcdefghijklmnopqrstuvwxyz";

	for (i = 0; i < length; i++)
		msg += alphabet.charAt(Math.floor(Math.random() * alphabet.length));

	message(msg);
}

function message(msg) {
	socket.send(msg);
	sent = sent + 1;
	update();
}

function update() {
	var cnt = document.getElementById("counter");

	cnt.innerHTML = "Recv: " + recv + " Sent: " + sent;
}

function onmessage(evt) {
	recv = recv + 1;
	update();

	message(evt.data);
}

function connect() {
	socket = new WebSocket("ws://127.0.0.1:8888/connect");

	socket.onopen = function(evt) { open(evt) };
	socket.onclose = function(evt) { alert("closed"); };
	socket.onmessage = function(evt) { onmessage(evt) };
	socket.onerror = function(evt) { alert("onerror"); };
}
</script>
</head>

<body>
<svg id="circle" height=200 width=450></svg>

<script>
var svg = d3.select("#circle").append("svg").attr("width", 200).attr("height", 200);
svg.append('circle')
  .attr('cx', 100)
  .attr('cy', 100)
  .attr('r', 50)
  .attr('stroke', 'black')
  .attr('fill', '#69a3b2');
		</script>
<form action="/" onsubmit="connect(); return false;">
<input type="submit" value="connect">
</form>

<div id="counter">
</div>

<input id="bob" placeholder="Enter some text" name="name"/>
<p id="values">jjj</p>
<div id="message">mike</div>

</body>

<script>
	function testmike(e){
	const message= document.getElementById("message");
	message.innerHTML = e;
		}
const input = document.querySelector("#bob");
const log = document.getElementById("values");
input.addEventListener('input',updateValue);
function updateValue(e){
	log.textContent = e.target.value; 
	message(log.textContent);
}
</script>
</html>
